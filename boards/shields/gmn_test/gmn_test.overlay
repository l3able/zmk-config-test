/* ADC for analog stick (Stick X/Y). On nRF52840 standard ADC: AIN2=P0.04, AIN3=P0.05.
 * If your stick is wired to P0.09/P0.10, verify ADC channel mapping on your board. */
&adc {
  status = "okay";
};

/ {
  chosen {
    zmk,kscan = &kscan0;
  };

  /* Analog stick XY → mouse movement */
  stick: analog_input_stick {
    compatible = "zmk,analog-input";
    sampling-hz = <100>;

    x-ch {
      io-channels = <&adc 2>;
      mv-mid = <250>;
      mv-min-max = <1600>;
      mv-deadzone = <300>;
      scale-multiplier = <1>;
      scale-divisor = <70>;
      evt-type = <2>;
      input-code = <0>;
    };

    y-ch {
      io-channels = <&adc 3>;
      mv-mid = <250>;
      mv-min-max = <1600>;
      mv-deadzone = <300>;
      scale-multiplier = <1>;
      scale-divisor = <70>;
      invert;
      evt-type = <2>;
      input-code = <1>;
    };
  };

  stick_listener: stick_listener {
    compatible = "zmk,input-listener";
    device = <&stick>;
  };

  kscan0: kscan {
    compatible = "zmk,kscan-gpio-matrix";
    label = "KSCAN";

    /*
     * Діоди на рядках — row2col.
     * Якщо діоди на колонках, поміняй на "col2row".
     */
    diode-direction = "row2col";

    /* ROWS: P0.17 P0.22 P1.00 P1.04 P1.07 */
    row-gpios =
      <&gpio0 17 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 22 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 0  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 4  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 7  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;

    /* COLS: P0.06 P0.08 P0.20 P0.24 P0.11 P1.06 P1.11 P1.13 P1.15 P0.02 P0.29 P0.31 */
    col-gpios =
      <&gpio0 6  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 8  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 20 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 24 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 11 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 6  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 11 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 13 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio1 15 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 2  (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 29 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
      <&gpio0 31 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
  };
};